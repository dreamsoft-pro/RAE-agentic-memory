2025-11-27T16:29:25.5101963Z ##[group]Run bandit -r apps/ sdk/ -ll || true
2025-11-27T16:29:25.5102313Z [36;1mbandit -r apps/ sdk/ -ll || true[0m
2025-11-27T16:29:25.5135340Z shell: /usr/bin/bash -e {0}
2025-11-27T16:29:25.5135563Z env:
2025-11-27T16:29:25.5135802Z   pythonLocation: /opt/hostedtoolcache/Python/3.11.14/x64
2025-11-27T16:29:25.5136394Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.11.14/x64/lib/pkgconfig
2025-11-27T16:29:25.5136898Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.14/x64
2025-11-27T16:29:25.5137253Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.14/x64
2025-11-27T16:29:25.5137608Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.11.14/x64
2025-11-27T16:29:25.5137960Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.11.14/x64/lib
2025-11-27T16:29:25.5138261Z ##[endgroup]
2025-11-27T16:29:25.6518917Z [main]	INFO	profile include tests: None
2025-11-27T16:29:25.6519520Z [main]	INFO	profile exclude tests: None
2025-11-27T16:29:25.6519965Z [main]	INFO	cli include tests: None
2025-11-27T16:29:25.6520480Z [main]	INFO	cli exclude tests: None
2025-11-27T16:29:25.6522427Z [main]	INFO	running on Python 3.11.14
2025-11-27T16:29:27.8326842Z Working... ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 100% 0:00:02
2025-11-27T16:29:27.8342145Z Run started:2025-11-27 16:29:27.833130+00:00
2025-11-27T16:29:27.8342553Z 
2025-11-27T16:29:27.8342671Z Test results:
2025-11-27T16:29:27.8343188Z >> Issue: [B324:hashlib] Use of weak MD5 hash for security. Consider usedforsecurity=False
2025-11-27T16:29:27.8343795Z    Severity: High   Confidence: High
2025-11-27T16:29:27.8344284Z    CWE: CWE-327 (https://cwe.mitre.org/data/definitions/327.html)
2025-11-27T16:29:27.8344939Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b324_hashlib.html
2025-11-27T16:29:27.8345592Z    Location: apps/memory_api/clients/rae_client.py:301:15
2025-11-27T16:29:27.8346054Z 300	        key_string = "|".join(key_parts)
2025-11-27T16:29:27.8346728Z 301	        return hashlib.md5(key_string.encode()).hexdigest()
2025-11-27T16:29:27.8347120Z 302	
2025-11-27T16:29:27.8347274Z 
2025-11-27T16:29:27.8347407Z --------------------------------------------------
2025-11-27T16:29:27.8348230Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8349041Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8349510Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8350226Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8351052Z    Location: apps/memory_api/repositories/cost_logs_repository.py:668:8
2025-11-27T16:29:27.8351590Z 667	    records = await pool.fetch(
2025-11-27T16:29:27.8351926Z 668	        f"""
2025-11-27T16:29:27.8352173Z 669	        SELECT *
2025-11-27T16:29:27.8352430Z 670	        FROM cost_logs
2025-11-27T16:29:27.8352740Z 671	        WHERE tenant_id = $1
2025-11-27T16:29:27.8353055Z 672	          AND project_id = $2
2025-11-27T16:29:27.8353379Z 673	          {error_filter}
2025-11-27T16:29:27.8353691Z 674	        ORDER BY timestamp DESC
2025-11-27T16:29:27.8354012Z 675	        LIMIT $3
2025-11-27T16:29:27.8354254Z 676	        """,
2025-11-27T16:29:27.8354491Z 677	        tenant_id,
2025-11-27T16:29:27.8354658Z 
2025-11-27T16:29:27.8354796Z --------------------------------------------------
2025-11-27T16:29:27.8355511Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8356403Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8356845Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8357565Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8358746Z    Location: apps/memory_api/repositories/memory_repository.py:87:22
2025-11-27T16:29:27.8359208Z 86	
2025-11-27T16:29:27.8359842Z 87	                sql = f"INSERT INTO memories ({columns_str}) VALUES ({placeholders_str}) RETURNING id, created_at, last_accessed_at, usage_count"
2025-11-27T16:29:27.8360934Z 88	
2025-11-27T16:29:27.8361070Z 
2025-11-27T16:29:27.8361216Z --------------------------------------------------
2025-11-27T16:29:27.8361959Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8362671Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8363119Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8363826Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8364595Z    Location: apps/memory_api/repositories/reflection_repository.py:273:18
2025-11-27T16:29:27.8365117Z 272	    # Count total matching
2025-11-27T16:29:27.8365567Z 273	    count_query = f"SELECT COUNT(*) FROM reflections WHERE {where_clause}"
2025-11-27T16:29:27.8366146Z 274	    total_count = await pool.fetchval(count_query, *params)
2025-11-27T16:29:27.8366648Z 
2025-11-27T16:29:27.8366785Z --------------------------------------------------
2025-11-27T16:29:27.8367471Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8368169Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8368610Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8369314Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8370104Z    Location: apps/memory_api/repositories/reflection_repository.py:288:12
2025-11-27T16:29:27.8370591Z 287	
2025-11-27T16:29:27.8370960Z 288	    query = f"SELECT * FROM reflections WHERE {where_clause} {order_clause}"
2025-11-27T16:29:27.8371511Z 289	    records = await pool.fetch(query, *params)
2025-11-27T16:29:27.8371786Z 
2025-11-27T16:29:27.8371909Z --------------------------------------------------
2025-11-27T16:29:27.8372623Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8373354Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8373787Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8374556Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8375332Z    Location: apps/memory_api/repositories/reflection_repository.py:467:12
2025-11-27T16:29:27.8375880Z 466	    where_clause = " AND ".join(conditions)
2025-11-27T16:29:27.8376525Z 467	    query = f"SELECT * FROM reflection_relationships WHERE {where_clause}"
2025-11-27T16:29:27.8376994Z 468	
2025-11-27T16:29:27.8377129Z 
2025-11-27T16:29:27.8377259Z --------------------------------------------------
2025-11-27T16:29:27.8377986Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8378850Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8379295Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8380008Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8380757Z    Location: apps/memory_api/repositories/reflection_repository.py:513:12
2025-11-27T16:29:27.8381293Z 512	    # Recursive query for graph traversal
2025-11-27T16:29:27.8381657Z 513	    query = f"""
2025-11-27T16:29:27.8381930Z 514	    WITH RECURSIVE graph AS (
2025-11-27T16:29:27.8382323Z 515	        -- Base case: starting reflection
2025-11-27T16:29:27.8382677Z 516	        SELECT
2025-11-27T16:29:27.8382924Z 517	            id,
2025-11-27T16:29:27.8383175Z 518	            0 as depth,
2025-11-27T16:29:27.8383648Z 519	            ARRAY[id] as path
2025-11-27T16:29:27.8383968Z 520	        FROM reflections
2025-11-27T16:29:27.8384254Z 521	        WHERE id = $1
2025-11-27T16:29:27.8384640Z 522	
2025-11-27T16:29:27.8384850Z 523	        UNION ALL
2025-11-27T16:29:27.8385091Z 524	
2025-11-27T16:29:27.8385537Z 525	        -- Recursive case: follow relationships
2025-11-27T16:29:27.8385901Z 526	        SELECT
2025-11-27T16:29:27.8386127Z 527	            r.id,
2025-11-27T16:29:27.8386546Z 528	            g.depth + 1,
2025-11-27T16:29:27.8386849Z 529	            g.path || r.id
2025-11-27T16:29:27.8387165Z 530	        FROM graph g
2025-11-27T16:29:27.8387636Z 531	        JOIN reflection_relationships rr ON rr.source_reflection_id = g.id
2025-11-27T16:29:27.8388221Z 532	        JOIN reflections r ON r.id = rr.target_reflection_id
2025-11-27T16:29:27.8388626Z 533	        WHERE
2025-11-27T16:29:27.8388864Z 534	            g.depth < $1
2025-11-27T16:29:27.8389165Z 535	            {relation_filter}
2025-11-27T16:29:27.8389487Z 536	            {strength_filter}
2025-11-27T16:29:27.8389877Z 537	            AND NOT (r.id = ANY(g.path))  -- Prevent cycles
2025-11-27T16:29:27.8390274Z 538	    )
2025-11-27T16:29:27.8390512Z 539	    SELECT DISTINCT id FROM graph
2025-11-27T16:29:27.8390836Z 540	    """
2025-11-27T16:29:27.8391048Z 541	
2025-11-27T16:29:27.8391167Z 
2025-11-27T16:29:27.8391301Z --------------------------------------------------
2025-11-27T16:29:27.8392000Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8392709Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8393159Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8393891Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8394676Z    Location: apps/memory_api/repositories/reflection_repository.py:553:22
2025-11-27T16:29:27.8395220Z 552	        # Fetch all edges between these nodes
2025-11-27T16:29:27.8395603Z 553	        edges_query = f"""
2025-11-27T16:29:27.8395949Z 554	        SELECT * FROM reflection_relationships
2025-11-27T16:29:27.8396462Z 555	        WHERE
2025-11-27T16:29:27.8396749Z 556	            source_reflection_id = ANY($1)
2025-11-27T16:29:27.8397176Z 557	            AND target_reflection_id = ANY($1)
2025-11-27T16:29:27.8397565Z 558	            {relation_filter}
2025-11-27T16:29:27.8397886Z 559	            {strength_filter}
2025-11-27T16:29:27.8398182Z 560	        """
2025-11-27T16:29:27.8398602Z 561	        edges_records = await pool.fetch(edges_query, node_ids, *relation_params)
2025-11-27T16:29:27.8399038Z 
2025-11-27T16:29:27.8399167Z --------------------------------------------------
2025-11-27T16:29:27.8399897Z >> Issue: [B608:hardcoded_sql_expressions] Possible SQL injection vector through string-based query construction.
2025-11-27T16:29:27.8400648Z    Severity: Medium   Confidence: Low
2025-11-27T16:29:27.8401085Z    CWE: CWE-89 (https://cwe.mitre.org/data/definitions/89.html)
2025-11-27T16:29:27.8401826Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b608_hardcoded_sql_expressions.html
2025-11-27T16:29:27.8402575Z    Location: apps/memory_api/services/reflection_pipeline.py:280:16
2025-11-27T16:29:27.8403090Z 279	        where_clause = " AND ".join(conditions)
2025-11-27T16:29:27.8403486Z 280	        query = f"""
2025-11-27T16:29:27.8403906Z 281	            SELECT id, content, embedding, tags, importance, created_at
2025-11-27T16:29:27.8404370Z 282	            FROM memories
2025-11-27T16:29:27.8404679Z 283	            WHERE {where_clause}
2025-11-27T16:29:27.8405018Z 284	            ORDER BY created_at DESC
2025-11-27T16:29:27.8405371Z 285	            LIMIT ${param_idx}
2025-11-27T16:29:27.8405676Z 286	        """
2025-11-27T16:29:27.8405943Z 287	        params.append(limit)
2025-11-27T16:29:27.8406384Z 
2025-11-27T16:29:27.8406535Z --------------------------------------------------
2025-11-27T16:29:27.8407114Z >> Issue: [B324:hashlib] Use of weak MD5 hash for security. Consider usedforsecurity=False
2025-11-27T16:29:27.8407854Z    Severity: High   Confidence: High
2025-11-27T16:29:27.8408288Z    CWE: CWE-327 (https://cwe.mitre.org/data/definitions/327.html)
2025-11-27T16:29:27.8408912Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b324_hashlib.html
2025-11-27T16:29:27.8409735Z    Location: apps/memory_api/services/vector_store/qdrant_store.py:102:28
2025-11-27T16:29:27.8410243Z 101	            if word not in stopwords:
2025-11-27T16:29:27.8410705Z 102	                index = int(hashlib.md5(word.encode()).hexdigest(), 16) % 100000
2025-11-27T16:29:27.8411185Z 103	                indices.append(index)
2025-11-27T16:29:27.8411427Z 
2025-11-27T16:29:27.8411557Z --------------------------------------------------
2025-11-27T16:29:27.8412068Z >> Issue: [B104:hardcoded_bind_all_interfaces] Possible binding to all interfaces.
2025-11-27T16:29:27.8412613Z    Severity: Medium   Confidence: Medium
2025-11-27T16:29:27.8413070Z    CWE: CWE-605 (https://cwe.mitre.org/data/definitions/605.html)
2025-11-27T16:29:27.8413783Z    More Info: https://bandit.readthedocs.io/en/1.9.2/plugins/b104_hardcoded_bind_all_interfaces.html
2025-11-27T16:29:27.8414429Z    Location: apps/ml_service/main.py:331:26
2025-11-27T16:29:27.8414761Z 330	
2025-11-27T16:29:27.8415041Z 331	    uvicorn.run(app, host="0.0.0.0", port=8001)
2025-11-27T16:29:27.8415301Z 
2025-11-27T16:29:27.8415422Z --------------------------------------------------
2025-11-27T16:29:27.8415673Z 
2025-11-27T16:29:27.8415765Z Code scanned:
2025-11-27T16:29:27.8416007Z 	Total lines of code: 31615
2025-11-27T16:29:27.8416471Z 	Total lines skipped (#nosec): 0
2025-11-27T16:29:27.8417016Z 	Total potential issues skipped due to specifically being disabled (e.g., #nosec BXXX): 0
2025-11-27T16:29:27.8417493Z 
2025-11-27T16:29:27.8417585Z Run metrics:
2025-11-27T16:29:27.8417832Z 	Total issues (by severity):
2025-11-27T16:29:27.8418115Z 		Undefined: 0
2025-11-27T16:29:27.8418342Z 		Low: 603
2025-11-27T16:29:27.8418562Z 		Medium: 9
2025-11-27T16:29:27.8418778Z 		High: 2
2025-11-27T16:29:27.8419009Z 	Total issues (by confidence):
2025-11-27T16:29:27.8419299Z 		Undefined: 0
2025-11-27T16:29:27.8419521Z 		Low: 8
2025-11-27T16:29:27.8419735Z 		Medium: 3
2025-11-27T16:29:27.8419954Z 		High: 603
2025-11-27T16:29:27.8420187Z Files skipped (0):
