#!/bin/bash

echo ""
echo "ğŸ” Sprawdzanie GitHub Actions przed commitem..."
echo ""

# SprawdÅº Actions
if [ -f .claude/scripts/check-actions.sh ]; then
    bash .claude/scripts/check-actions.sh
    ACTIONS_STATUS=$?
    
    if [ $ACTIONS_STATUS -eq 1 ]; then
        echo ""
        echo "âš ï¸  UWAGA: Ostatni GitHub Actions FAILED!"
        echo "Czy na pewno chcesz commitowaÄ‡? (y/n)"
        read -r response
        if [[ ! "$response" =~ ^[Yy]$ ]]; then
            echo "âŒ Commit anulowany"
            exit 1
        fi
    fi
fi

# Lint check
echo ""
echo "ğŸ” Uruchamiam linter..."
if [ -f Makefile ]; then
    make lint || { echo "âŒ Linter failed"; exit 1; }
else
    echo "âš ï¸  Makefile not found, skipping lint."
fi

# Test check
echo ""
echo "ğŸ§ª Uruchamiam testy..."
if [ -f Makefile ]; then
    make test-unit || { echo "âŒ Tests failed"; exit 1; }
else
    echo "âš ï¸  Makefile not found, skipping tests."
fi

echo ""
echo "âœ… Pre-commit checks zakoÅ„czone!"
echo ""