
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Feniks Intermediate Representation (IR)",
    "description": "A canonical representation of a code chunk and its metadata.",
    "type": "object",
    "properties": {
        "id": { "type": "string" },
        "file_path": { "type": "string" },
        "start_line": { "type": "integer", "minimum": 0 },
        "end_line": { "type": "integer", "minimum": 0 },
        "text": { "type": "string" },
        "chunk_name": { "type": "string" },
        "language": { "type": "string" },
        "module": { "type": ["string", "null"] },
        "kind": { "type": ["string", "null"] },
        "ast_node_type": { "type": ["string", "null"] },
        "dependencies": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "type": { "type": "string" },
                    "value": { "type": "string" }
                },
                "required": ["type", "value"]
            }
        },
        "calls_functions": { "type": "array", "items": { "type": "string" } },
        "api_endpoints": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "url": { "type": "string" },
                    "method": { "type": "string" },
                    "dataKeys": { "type": "array", "items": { "type": "string" } },
                    "paramKeys": { "type": "array", "items": { "type": "string" } }
                },
                "required": ["url", "method"]
            }
        },
        "ui_routes": { "type": "array", "items": { "type": "string" } },
        "cyclomatic_complexity": { "type": "integer" },
        "business_tags": { "type": "array", "items": { "type": "string" } },
        "git_last_commit": {
            "type": ["object", "null"],
            "properties": {
                "hash": { "type": "string" },
                "author": { "type": "string" },
                "date": { "type": "string" },
                "summary": { "type": "string" }
            },
            "required": ["hash", "author", "date", "summary"]
        },
        "evidence": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "source": { "type": "string" },
                    "rule": { "type": "string" },
                    "confidence": { "type": "number" },
                    "file": { "type": "string" },
                    "start_line": { "type": "integer" },
                    "end_line": { "type": "integer" }
                },
                "required": ["source", "rule", "confidence", "file", "start_line", "end_line"]
            }
        },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "criticality_score": { "type": "number" },
        "migration_target": { "type": ["string", "null"] },
        "invariants": { "type": "array", "items": { "type": "string" } },
        "io_contract": { "type": "object" },
        "api_contract_ref": { "type": ["string", "null"] }
    },
    "required": [
        "id", "file_path", "start_line", "end_line", "text", "chunk_name", "language",
        "dependencies", "calls_functions", "api_endpoints", "ui_routes",
        "cyclomatic_complexity", "business_tags", "evidence", "confidence",
        "criticality_score", "invariants", "io_contract"
    ]
}
