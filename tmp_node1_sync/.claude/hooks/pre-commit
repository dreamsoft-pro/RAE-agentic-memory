#!/bin/bash

echo ""
echo "üîç Sprawdzanie GitHub Actions przed commitem..."
echo ""

# Sprawd≈∫ Actions
if [ -f .claude/scripts/check-actions.sh ]; then
    bash .claude/scripts/check-actions.sh
    ACTIONS_STATUS=$?
    
    if [ $ACTIONS_STATUS -eq 1 ]; then
        echo ""
        echo "‚ö†Ô∏è  UWAGA: Ostatni GitHub Actions FAILED!"
        echo "Czy na pewno chcesz commitowaƒá? (y/n)"
        read -r response
        if [[ ! "$response" =~ ^[Yy]$ ]]; then
            echo "‚ùå Commit anulowany"
            exit 1
        fi
    fi
fi

# Lint check
echo ""
echo "üîç Uruchamiam linter..."
if [ -f Makefile ]; then
    make lint || { echo "‚ùå Linter failed"; exit 1; }
else
    echo "‚ö†Ô∏è  Makefile not found, skipping lint."
fi

# Security check (optional, don't fail commit on security warnings unless critical)
echo ""
echo "üîí Uruchamiam skan bezpiecze≈Ñstwa..."
if [ -f Makefile ]; then
    make security || echo "‚ö†Ô∏è  Security scan had findings (check logs)"
else
    echo "‚ö†Ô∏è  Makefile not found, skipping security scan."
fi

# Test check
echo ""
echo "üß™ Uruchamiam testy..."
if [ -f Makefile ]; then
    make test-unit || { echo "‚ùå Tests failed"; exit 1; }
else
    echo "‚ö†Ô∏è  Makefile not found, skipping tests."
fi

echo ""
echo "‚úÖ Pre-commit checks zako≈Ñczone!"
echo ""