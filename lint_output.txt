ðŸ” Running linters...
warning: The top-level linter settings are deprecated in favour of their counterparts in the `lint` section. Please update the following options in `pyproject.toml`:
  - 'ignore' -> 'lint.ignore'
  - 'select' -> 'lint.select'
W291 Trailing whitespace
  --> apps/memory_api/adapters/postgres_adapter.py:95:30
   |
93 |     async def _get_tables(self, conn: asyncpg.Connection) -> Set[str]:
94 |         query = """
95 |             SELECT table_name 
   |                              ^
96 |             FROM information_schema.tables 
97 |             WHERE table_schema = 'public'
   |
help: Remove trailing whitespace

W291 Trailing whitespace
  --> apps/memory_api/adapters/postgres_adapter.py:96:43
   |
94 |         query = """
95 |             SELECT table_name 
96 |             FROM information_schema.tables 
   |                                           ^
97 |             WHERE table_schema = 'public'
98 |         """
   |
help: Remove trailing whitespace

W291 Trailing whitespace
   --> apps/memory_api/adapters/postgres_adapter.py:108:44
    |
106 |         query = """
107 |             SELECT column_name, data_type, udt_name
108 |             FROM information_schema.columns 
    |                                            ^
109 |             WHERE table_name = $1 AND table_schema = 'public'
110 |         """
    |
help: Remove trailing whitespace

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/api/v1/agent.py:155:17
    |
153 |                 span.set_attribute("rae.outcome.label", "reranker_error")
154 |                 span.set_attribute("rae.error.message", str(e))
155 |                 raise HTTPException(status_code=502, detail=f"Reranker error: {e}")
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
156 |
157 |             rerank_scores = {item["id"]: item["score"] for item in reranked_items}
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/api/v1/agent.py:234:13
    |
232 |             span.set_attribute("rae.outcome.label", "llm_error")
233 |             span.set_attribute("rae.error.message", str(e))
234 |             raise HTTPException(status_code=500, detail=f"LLM call failed: {e}")
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
235 |
236 |         # 7. Reflection hook
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/compliance.py:168:10
    |
166 | async def request_approval(
167 |     request: ApprovalRequest,
168 |     pool=Depends(get_db_pool),
    |          ^^^^^^^^^^^^^^^^^^^^
169 |     tenant_access: bool = Depends(verify_tenant_access),
170 | ):
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/compliance.py:236:10
    |
234 | async def check_approval_status(
235 |     request_id: UUID,
236 |     pool=Depends(get_db_pool),
    |          ^^^^^^^^^^^^^^^^^^^^
237 |     token_verified: bool = Depends(auth.verify_token),
238 | ):
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/compliance.py:289:10
    |
287 |     request_id: UUID,
288 |     decision: DecisionRequest,
289 |     pool=Depends(get_db_pool),
    |          ^^^^^^^^^^^^^^^^^^^^
290 |     token_verified: bool = Depends(auth.verify_token),
291 | ):
    |

B008 Do not perform function call `Query` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/compliance.py:667:41
    |
665 | async def list_policies(
666 |     tenant_id: Optional[str] = Query(None),
667 |     policy_type: Optional[PolicyType] = Query(None),
    |                                         ^^^^^^^^^^^
668 |     token_verified: bool = Depends(auth.verify_token),
669 | ):
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/api/v1/feedback.py:20:35
   |
18 |     request: Request,
19 |     tenant_id: str = Depends(get_and_verify_tenant_id),
20 |     rae_service: RAECoreService = Depends(get_rae_core_service),
   |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
21 | ):
22 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/governance.py:101:10
    |
 99 | async def get_governance_overview(
100 |     days: int = Query(30, ge=1, le=365, description="Number of days to analyze"),
101 |     pool=Depends(get_db_pool),
    |          ^^^^^^^^^^^^^^^^^^^^
102 |     admin_access: bool = Depends(require_admin),
103 | ):
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/governance.py:212:10
    |
210 |     tenant_id: str,
211 |     days: int = Query(30, ge=1, le=365, description="Number of days to analyze"),
212 |     pool=Depends(get_db_pool),
    |          ^^^^^^^^^^^^^^^^^^^^
213 |     tenant_access: bool = Depends(verify_tenant_access),
214 | ):
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/governance.py:367:10
    |
365 | async def get_tenant_budget_status(
366 |     tenant_id: str,
367 |     pool=Depends(get_db_pool),
    |          ^^^^^^^^^^^^^^^^^^^^
368 |     tenant_access: bool = Depends(verify_tenant_access),
369 | ):
    |

W292 [*] No newline at end of file
   --> apps/memory_api/api/v1/governance.py:506:21
    |
504 |             raise HTTPException(
505 |                 status_code=500, detail=f"Failed to get budget status: {str(e)}"
506 |             ) from e
    |                     ^
    |
help: Add trailing newline

I001 [*] Import block is un-sorted or un-formatted
  --> apps/memory_api/api/v1/graph.py:11:1
   |
 9 |   """
10 |
11 | / from typing import Any, Dict, List, Optional
12 | |
13 | | import structlog
14 | | from fastapi import APIRouter, Depends, HTTPException, Query, Request
15 | | from pydantic import BaseModel, Field
16 | |
17 | | from apps.memory_api.dependencies import get_rae_core_service
18 | | from apps.memory_api.models.graph import TraversalStrategy
19 | | from apps.memory_api.models.graph_enhanced_models import TraversalAlgorithm
20 | | from apps.memory_api.repositories.graph_repository_enhanced import (
21 | |     EnhancedGraphRepository,
22 | | )
23 | | from apps.memory_api.services.hybrid_search_service import HybridSearchService
24 | | from apps.memory_api.security import auth
25 | | from apps.memory_api.services.graph_extraction import GraphExtractionResult
26 | | from apps.memory_api.services.rae_core_service import RAECoreService
27 | | from apps.memory_api.services.reflection_engine import ReflectionEngine
   | |_______________________________________________________________________^
28 |
29 |   logger = structlog.get_logger(__name__)
   |
help: Organize imports

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/graph.py:611:35
    |
609 |     req: GraphSearchRequest,
610 |     request: Request,
611 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
612 | ):
613 |     """
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/api/v1/graph.py:646:9
    |
644 |           strategy = TraversalStrategy(req.traversal_strategy.lower())
645 |       except ValueError:
646 | /         raise HTTPException(
647 | |             status_code=400,
648 | |             detail=f"Invalid traversal_strategy. Must be 'bfs' or 'dfs', got '{req.traversal_strategy}'",
649 | |         )
    | |_________^
650 |
651 |       logger.info(
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/graph.py:703:35
    |
701 |     node_ids: str = Query(..., description="Comma-separated node IDs to start from"),
702 |     depth: int = Query(default=1, ge=1, le=5, description="Traversal depth"),
703 |     rae_service: RAECoreService = Depends(get_rae_core_service),  # Use RAECoreService
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
704 | ):
705 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/api/v1/graph.py:789:17
    |
787 |         raise HTTPException(
788 |             status_code=500, detail=f"Failed to retrieve subgraph: {str(e)}"
789 |         ) from e
    |                 ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/api/v1/memory.py:47:35
   |
45 |     request: Request,
46 |     tenant_id: str = Depends(get_and_verify_tenant_id),
47 |     rae_service: RAECoreService = Depends(get_rae_core_service),
   |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
48 | ):
49 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/memory.py:105:35
    |
103 |     request: Request,
104 |     tenant_id: str = Depends(get_and_verify_tenant_id),
105 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
106 | ):
107 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/memory.py:210:35
    |
208 |     request: Request,
209 |     tenant_id: str = Depends(get_and_verify_tenant_id),
210 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
211 | ):
212 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/memory.py:304:35
    |
302 |     tenant_id: str = Depends(get_and_verify_tenant_id),
303 |     project: Optional[str] = None,
304 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
305 | ):
306 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v1/memory.py:344:35
    |
342 |         None, description="Maximum episodes to process", ge=1
343 |     ),
344 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
345 | ):
346 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/api/v1/memory.py:453:21
    |
451 |                 status_code=500,
452 |                 detail=f"Hierarchical reflection generation failed: {str(e)}",
453 |             ) from e
    |                     ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/api/v2/memory.py:72:35
   |
70 |     request: StoreMemoryRequestV2,
71 |     tenant_id: str = Depends(get_and_verify_tenant_id),
72 |     rae_service: RAECoreService = Depends(get_rae_core_service),
   |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
73 | ):
74 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v2/memory.py:106:35
    |
104 |     request: QueryMemoryRequestV2,
105 |     tenant_id: str = Depends(get_and_verify_tenant_id),
106 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
107 | ):
108 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v2/memory.py:156:35
    |
154 |     project: str,
155 |     tenant_id: str = Depends(get_and_verify_tenant_id),
156 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
157 | ):
158 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v2/memory.py:186:35
    |
184 |     project: str,
185 |     tenant_id: str = Depends(get_and_verify_tenant_id),
186 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
187 | ):
188 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/api/v2/memory.py:226:35
    |
224 |     project: str,
225 |     tenant_id: str = Depends(get_and_verify_tenant_id),
226 |     rae_service: RAECoreService = Depends(get_rae_core_service),
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
227 | ):
228 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/api/v2/memory.py:251:17
    |
249 |         raise HTTPException(
250 |             status_code=500, detail=f"Failed to get statistics: {str(e)}"
251 |         ) from e
    |                 ^
    |
help: Add trailing newline

B007 Loop control variable `relevance` not used within loop body
   --> apps/memory_api/core/information_bottleneck.py:161:35
    |
159 |             current_tokens = 0
160 |
161 |             for memory, ib_score, relevance, comp_cost in ib_scores_sorted:
    |                                   ^^^^^^^^^
162 |                 if ib_score == -np.inf:
163 |                     continue
    |
help: Rename unused `relevance` to `_relevance`

B007 Loop control variable `comp_cost` not used within loop body
   --> apps/memory_api/core/information_bottleneck.py:161:46
    |
159 |             current_tokens = 0
160 |
161 |             for memory, ib_score, relevance, comp_cost in ib_scores_sorted:
    |                                              ^^^^^^^^^
162 |                 if ib_score == -np.inf:
163 |                     continue
    |
help: Rename unused `comp_cost` to `_comp_cost`

F401 [*] `apps.llm.broker.llm_router` imported but unused
 --> apps/memory_api/observability/health_checks.py:7:38
  |
5 | from redis.asyncio import Redis as AsyncRedis
6 |
7 | import apps.llm.broker.llm_router as llm_broker
  |                                      ^^^^^^^^^^
8 | import apps.memory_api.dependencies as deps  # Modified import
9 | from apps.memory_api.config import settings
  |
help: Remove unused import: `apps.llm.broker.llm_router`

F401 [*] `apps.memory_api.config.settings` imported but unused
  --> apps/memory_api/observability/health_checks.py:9:36
   |
 7 | import apps.llm.broker.llm_router as llm_broker
 8 | import apps.memory_api.dependencies as deps  # Modified import
 9 | from apps.memory_api.config import settings
   |                                    ^^^^^^^^
10 |
11 | router = APIRouter()
   |
help: Remove unused import: `apps.memory_api.config.settings`

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:16:25
   |
15 | async def check_postgres(
16 |     pool: AsyncpgPool = Depends(deps.get_db_pool),
   |                         ^^^^^^^^^^^^^^^^^^^^^^^^^
17 | ):
18 |     """Check PostgreSQL connection."""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:31:32
   |
30 | async def check_redis(
31 |     redis_client: AsyncRedis = Depends(deps.get_redis_client),
   |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 | ):  # Used deps.get_redis_client
33 |     """Check Redis connection."""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:45:40
   |
44 | async def check_qdrant(
45 |     qdrant_client: AsyncQdrantClient = Depends(deps.get_qdrant_client),
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
46 | ):  # Used deps.get_qdrant_client
47 |     """Check Qdrant connection."""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:65:23
   |
63 | @router.get("/health", response_model=dict, summary="Overall Health Check")
64 | async def get_overall_health(
65 |     pg_status: dict = Depends(check_postgres),
   |                       ^^^^^^^^^^^^^^^^^^^^^^^
66 |     redis_status: dict = Depends(check_redis),
67 |     qdrant_status: dict = Depends(check_qdrant),
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:66:26
   |
64 | async def get_overall_health(
65 |     pg_status: dict = Depends(check_postgres),
66 |     redis_status: dict = Depends(check_redis),
   |                          ^^^^^^^^^^^^^^^^^^^^
67 |     qdrant_status: dict = Depends(check_qdrant),
68 |     llm_status: dict = Depends(check_llm_provider),
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:67:27
   |
65 |     pg_status: dict = Depends(check_postgres),
66 |     redis_status: dict = Depends(check_redis),
67 |     qdrant_status: dict = Depends(check_qdrant),
   |                           ^^^^^^^^^^^^^^^^^^^^^
68 |     llm_status: dict = Depends(check_llm_provider),
69 | ):
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/observability/health_checks.py:68:24
   |
66 |     redis_status: dict = Depends(check_redis),
67 |     qdrant_status: dict = Depends(check_qdrant),
68 |     llm_status: dict = Depends(check_llm_provider),
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
69 | ):
70 |     """
   |

W291 Trailing whitespace
  --> apps/memory_api/repositories/token_savings_repository.py:83:19
   |
81 |         # Aggregation query
82 |         query = f"""
83 |             SELECT 
   |                   ^
84 |                 COALESCE(SUM(saved_tokens), 0) as total_tokens,
85 |                 COALESCE(SUM(estimated_cost_saved_usd), 0) as total_usd,
   |
help: Remove trailing whitespace

W291 Trailing whitespace
   --> apps/memory_api/repositories/token_savings_repository.py:135:19
    |
134 |         query = """
135 |             SELECT 
    |                   ^
136 |                 date_trunc($2, timestamp) as bucket,
137 |                 SUM(saved_tokens) as saved_tokens,
    |
help: Remove trailing whitespace

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/dashboard.py:83:33
   |
83 | async def get_metrics_repo(pool=Depends(get_pool)) -> MetricsRepository:
   |                                 ^^^^^^^^^^^^^^^^^
84 |     """Get metrics repository instance"""
85 |     return MetricsRepository(pool)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/dashboard.py:88:39
   |
88 | async def get_compliance_service(pool=Depends(get_pool)) -> ComplianceService:
   |                                       ^^^^^^^^^^^^^^^^^
89 |     """Get compliance service instance"""
90 |     return ComplianceService(pool)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/dashboard.py:93:32
   |
93 | def get_websocket_service(pool=Depends(get_pool)) -> DashboardWebSocketService:
   |                                ^^^^^^^^^^^^^^^^^
94 |     """Get or create WebSocket service instance."""
95 |     global _websocket_service
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/dashboard.py:195:47
    |
193 | @router.post("/metrics", response_model=GetDashboardMetricsResponse)
194 | async def get_dashboard_metrics(
195 |     request: GetDashboardMetricsRequest, pool=Depends(get_pool)
    |                                               ^^^^^^^^^^^^^^^^^
196 | ):
197 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/dashboard.py:248:31
    |
246 |     project_id: str,
247 |     period: MetricPeriod = MetricPeriod.LAST_24H,
248 |     repo: MetricsRepository = Depends(get_metrics_repo),
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^
249 | ):
250 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/dashboard.py:350:68
    |
349 | @router.post("/visualizations", response_model=GetVisualizationResponse)
350 | async def get_visualization(request: GetVisualizationRequest, pool=Depends(get_pool)):
    |                                                                    ^^^^^^^^^^^^^^^^^
351 |     """
352 |     Generate visualization data.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/dashboard.py:427:67
    |
426 | @router.post("/health", response_model=GetSystemHealthResponse)
427 | async def get_system_health(request: GetSystemHealthRequest, pool=Depends(get_pool)):
    |                                                                   ^^^^^^^^^^^^^^^^^
428 |     """
429 |     Get system health status.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/dashboard.py:468:36
    |
467 | @router.get("/health/simple")
468 | async def simple_health_check(pool=Depends(get_pool)):
    |                                    ^^^^^^^^^^^^^^^^^
469 |     """
470 |     Simple health check endpoint.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/dashboard.py:502:10
    |
500 |     limit: int = 100,
501 |     event_types: Optional[str] = Query(None),
502 |     pool=Depends(get_pool),
    |          ^^^^^^^^^^^^^^^^^
503 | ):
504 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
    --> apps/memory_api/routes/dashboard.py:1002:45
     |
1000 | async def get_compliance_report(
1001 |     request: GetComplianceReportRequest,
1002 |     compliance_service: ComplianceService = Depends(get_compliance_service),
     |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1003 | ):
1004 |     """
     |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
    --> apps/memory_api/routes/dashboard.py:1075:45
     |
1073 | async def get_compliance_metrics(
1074 |     request: GetComplianceMetricsRequest,
1075 |     compliance_service: ComplianceService = Depends(get_compliance_service),
     |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1076 | ):
1077 |     """
     |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
    --> apps/memory_api/routes/dashboard.py:1152:45
     |
1150 | async def get_risk_register(
1151 |     request: GetRiskRegisterRequest,
1152 |     compliance_service: ComplianceService = Depends(get_compliance_service),
     |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1153 | ):
1154 |     """
     |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
    --> apps/memory_api/routes/dashboard.py:1269:45
     |
1267 | async def get_rls_status(
1268 |     tenant_id: str = Query(..., description="Tenant ID"),
1269 |     compliance_service: ComplianceService = Depends(get_compliance_service),
     |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
1270 | ):
1271 |     """
     |

W292 [*] No newline at end of file
    --> apps/memory_api/routes/dashboard.py:1310:17
     |
1308 |         raise HTTPException(
1309 |             status_code=500, detail=f"Failed to verify RLS status: {str(e)}"
1310 |         ) from e
     |                 ^
     |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/evaluation.py:49:33
   |
49 | async def get_ab_test_repo(pool=Depends(get_pool)) -> ABTestRepository:
   |                                 ^^^^^^^^^^^^^^^^^
50 |     """Get A/B test repository"""
51 |     return ABTestRepository(pool)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/evaluation.py:54:35
   |
54 | async def get_benchmark_repo(pool=Depends(get_pool)) -> BenchmarkRepository:
   |                                   ^^^^^^^^^^^^^^^^^
55 |     """Get benchmark repository"""
56 |     return BenchmarkRepository(pool)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/evaluation.py:66:42
   |
64 | @router.post("/search", response_model=EvaluateSearchResponse)
65 | async def evaluate_search_results(
66 |     request: EvaluateSearchRequest, pool=Depends(get_pool)
   |                                          ^^^^^^^^^^^^^^^^^
67 | ):
68 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/evaluation.py:162:58
    |
161 | @router.post("/drift/detect", response_model=DetectDriftResponse)
162 | async def detect_drift(request: DetectDriftRequest, pool=Depends(get_pool)):
    |                                                          ^^^^^^^^^^^^^^^^^
163 |     """
164 |     Detect distribution drift between baseline and current periods.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/evaluation.py:258:60
    |
256 | @router.post("/ab-test/create", response_model=CreateABTestResponse, status_code=201)
257 | async def create_ab_test(
258 |     request: CreateABTestRequest, repo: ABTestRepository = Depends(get_ab_test_repo)
    |                                                            ^^^^^^^^^^^^^^^^^^^^^^^^^
259 | ):
260 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/evaluation.py:330:44
    |
328 | @router.post("/ab-test/{test_id}/compare")
329 | async def compare_ab_test_variants(
330 |     test_id: str, repo: ABTestRepository = Depends(get_ab_test_repo)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^
331 | ):
332 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/evaluation.py:407:45
    |
405 | @router.post("/quality/metrics", response_model=GetQualityMetricsResponse)
406 | async def get_quality_metrics(
407 |     request: GetQualityMetricsRequest, pool=Depends(get_pool)
    |                                             ^^^^^^^^^^^^^^^^^
408 | ):
409 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/evaluation.py:485:33
    |
483 |     tenant_id: str,
484 |     project_id: str,
485 |     repo: BenchmarkRepository = Depends(get_benchmark_repo),
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
486 | ):
487 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/evaluation.py:545:33
    |
543 |     tenant_id: str,
544 |     project_id: str,
545 |     repo: BenchmarkRepository = Depends(get_benchmark_repo),
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
546 | ):
547 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/routes/evaluation.py:651:6
    |
649 |             ],
650 |         },
651 |     }
    |      ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/event_triggers.py:56:33
   |
56 | async def get_trigger_repo(pool=Depends(get_pool)) -> TriggerRepository:
   |                                 ^^^^^^^^^^^^^^^^^
57 |     """Get trigger repository instance"""
58 |     return TriggerRepository(pool)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/event_triggers.py:61:34
   |
61 | async def get_workflow_repo(pool=Depends(get_pool)) -> WorkflowRepository:
   |                                  ^^^^^^^^^^^^^^^^^
62 |     """Get workflow repository instance"""
63 |     return WorkflowRepository(pool)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/event_triggers.py:73:62
   |
71 | @router.post("/create", response_model=CreateTriggerResponse, status_code=201)
72 | async def create_trigger(
73 |     request: CreateTriggerRequest, repo: TriggerRepository = Depends(get_trigger_repo)
   |                                                              ^^^^^^^^^^^^^^^^^^^^^^^^^
74 | ):
75 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:121:48
    |
119 | @router.get("/{trigger_id}", response_model=TriggerRule)
120 | async def get_trigger(
121 |     trigger_id: str, repo: TriggerRepository = Depends(get_trigger_repo)
    |                                                ^^^^^^^^^^^^^^^^^^^^^^^^^
122 | ):
123 |     """Get trigger rule by ID"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:143:31
    |
141 |     trigger_id: str,
142 |     request: UpdateTriggerRequest,
143 |     repo: TriggerRepository = Depends(get_trigger_repo),
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^
144 | ):
145 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:197:48
    |
195 | @router.delete("/{trigger_id}")
196 | async def delete_trigger(
197 |     trigger_id: str, repo: TriggerRepository = Depends(get_trigger_repo)
    |                                                ^^^^^^^^^^^^^^^^^^^^^^^^^
198 | ):
199 |     """Delete trigger rule"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:218:48
    |
217 | @router.post("/{trigger_id}/enable")
218 | async def enable_trigger(trigger_id: str, pool=Depends(get_pool)):
    |                                                ^^^^^^^^^^^^^^^^^
219 |     """Enable a trigger rule"""
220 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:235:49
    |
234 | @router.post("/{trigger_id}/disable")
235 | async def disable_trigger(trigger_id: str, pool=Depends(get_pool)):
    |                                                 ^^^^^^^^^^^^^^^^^
236 |     """Disable a trigger rule"""
237 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:257:31
    |
255 |     status_filter: Optional[str] = None,
256 |     limit: int = 100,
257 |     repo: TriggerRepository = Depends(get_trigger_repo),
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^
258 | ):
259 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:289:54
    |
288 | @router.post("/events/emit", response_model=EmitEventResponse)
289 | async def emit_event(request: EmitEventRequest, pool=Depends(get_pool)):
    |                                                      ^^^^^^^^^^^^^^^^^
290 |     """
291 |     Emit a custom event to trigger automation rules.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:365:31
    |
363 | async def get_trigger_executions(
364 |     request: GetTriggerExecutionsRequest,
365 |     repo: TriggerRepository = Depends(get_trigger_repo),
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^
366 | ):
367 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:417:32
    |
415 | async def create_workflow(
416 |     request: CreateWorkflowRequest,
417 |     repo: WorkflowRepository = Depends(get_workflow_repo),
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^
418 | ):
419 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:455:50
    |
453 | @router.get("/workflows/{workflow_id}")
454 | async def get_workflow(
455 |     workflow_id: str, repo: WorkflowRepository = Depends(get_workflow_repo)
    |                                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^
456 | ):
457 |     """Get workflow definition by ID"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:478:32
    |
476 |     project_id: str,
477 |     limit: int = 100,
478 |     repo: WorkflowRepository = Depends(get_workflow_repo),
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^
479 | ):
480 |     """List workflows"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/event_triggers.py:558:10
    |
556 |     parameters: dict,
557 |     created_by: str,
558 |     pool=Depends(get_pool),
    |          ^^^^^^^^^^^^^^^^^
559 | ):
560 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/routes/event_triggers.py:689:6
    |
687 |             },
688 |         },
689 |     }
    |      ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/graph_enhanced.py:72:61
   |
71 | @router.post("/nodes", response_model=EnhancedGraphNode, status_code=201)
72 | async def create_node(request: CreateGraphNodeRequest, pool=Depends(get_pool)):
   |                                                             ^^^^^^^^^^^^^^^^^
73 |     """
74 |     Create a knowledge graph node.
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:99:57
    |
 97 | @router.get("/nodes/{node_id}/metrics", response_model=GetNodeMetricsResponse)
 98 | async def get_node_metrics(
 99 |     tenant_id: str, project_id: str, node_id: str, pool=Depends(get_pool)
    |                                                         ^^^^^^^^^^^^^^^^^
100 | ):
101 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:127:46
    |
125 | @router.post("/nodes/connected", response_model=FindConnectedNodesResponse)
126 | async def find_connected_nodes(
127 |     request: FindConnectedNodesRequest, pool=Depends(get_pool)
    |                                              ^^^^^^^^^^^^^^^^^
128 | ):
129 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:160:61
    |
159 | @router.post("/edges", response_model=EnhancedGraphEdge, status_code=201)
160 | async def create_edge(request: CreateGraphEdgeRequest, pool=Depends(get_pool)):
    |                                                             ^^^^^^^^^^^^^^^^^
161 |     """
162 |     Create a weighted, temporal knowledge graph edge.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:208:58
    |
206 | @router.put("/edges/{edge_id}/weight", response_model=EnhancedGraphEdge)
207 | async def update_edge_weight(
208 |     edge_id: str, request: UpdateEdgeWeightRequest, pool=Depends(get_pool)
    |                                                          ^^^^^^^^^^^^^^^^^
209 | ):
210 |     """Update edge weight and optionally confidence"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:231:56
    |
229 | @router.post("/edges/{edge_id}/deactivate", response_model=EnhancedGraphEdge)
230 | async def deactivate_edge(
231 |     edge_id: str, request: DeactivateEdgeRequest, pool=Depends(get_pool)
    |                                                        ^^^^^^^^^^^^^^^^^
232 | ):
233 |     """Deactivate an edge (soft delete)"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:250:54
    |
248 | @router.post("/edges/{edge_id}/activate", response_model=EnhancedGraphEdge)
249 | async def activate_edge(
250 |     edge_id: str, request: ActivateEdgeRequest, pool=Depends(get_pool)
    |                                                      ^^^^^^^^^^^^^^^^^
251 | ):
252 |     """Reactivate a deactivated edge"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:269:65
    |
267 | @router.put("/edges/{edge_id}/temporal", response_model=EnhancedGraphEdge)
268 | async def set_edge_temporal_validity(
269 |     edge_id: str, request: SetEdgeTemporalValidityRequest, pool=Depends(get_pool)
    |                                                                 ^^^^^^^^^^^^^^^^^
270 | ):
271 |     """Set temporal validity window for an edge"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:296:62
    |
295 | @router.post("/traverse", response_model=TraverseGraphResponse)
296 | async def traverse_graph(request: TraverseGraphRequest, pool=Depends(get_pool)):
    |                                                              ^^^^^^^^^^^^^^^^^
297 |     """
298 |     Perform temporal graph traversal with BFS or DFS.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:370:61
    |
369 | @router.post("/path/shortest", response_model=FindPathResponse)
370 | async def find_shortest_path(request: FindPathRequest, pool=Depends(get_pool)):
    |                                                             ^^^^^^^^^^^^^^^^^
371 |     """
372 |     Find weighted shortest path between two nodes using Dijkstra.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:426:58
    |
425 | @router.post("/cycles/detect", response_model=DetectCycleResponse)
426 | async def detect_cycle(request: DetectCycleRequest, pool=Depends(get_pool)):
    |                                                          ^^^^^^^^^^^^^^^^^
427 |     """
428 |     Detect if adding an edge would create a cycle.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:466:64
    |
465 | @router.post("/snapshots", response_model=CreateSnapshotResponse, status_code=201)
466 | async def create_snapshot(request: CreateSnapshotRequest, pool=Depends(get_pool)):
    |                                                                ^^^^^^^^^^^^^^^^^
467 |     """
468 |     Create a versioned snapshot of the graph.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:508:47
    |
507 | @router.get("/snapshots/{snapshot_id}", response_model=GraphSnapshot)
508 | async def get_snapshot(snapshot_id: str, pool=Depends(get_pool)):
    |                                               ^^^^^^^^^^^^^^^^^
509 |     """Get snapshot details by ID"""
510 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:531:60
    |
529 | @router.get("/snapshots", response_model=List[GraphSnapshot])
530 | async def list_snapshots(
531 |     tenant_id: str, project_id: str, limit: int = 10, pool=Depends(get_pool)
    |                                                            ^^^^^^^^^^^^^^^^^
532 | ):
533 |     """List recent snapshots"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:550:61
    |
548 | @router.post("/snapshots/{snapshot_id}/restore", response_model=RestoreSnapshotResponse)
549 | async def restore_snapshot(
550 |     snapshot_id: str, request: RestoreSnapshotRequest, pool=Depends(get_pool)
    |                                                             ^^^^^^^^^^^^^^^^^
551 | ):
552 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:591:46
    |
589 | @router.post("/statistics", response_model=GetGraphStatisticsResponse)
590 | async def get_graph_statistics(
591 |     request: GetGraphStatisticsRequest, pool=Depends(get_pool)
    |                                              ^^^^^^^^^^^^^^^^^
592 | ):
593 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:626:69
    |
625 | @router.post("/nodes/batch", response_model=BatchOperationResponse, status_code=201)
626 | async def batch_create_nodes(request: BatchCreateNodesRequest, pool=Depends(get_pool)):
    |                                                                     ^^^^^^^^^^^^^^^^^
627 |     """
628 |     Create multiple nodes in batch.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/graph_enhanced.py:658:69
    |
657 | @router.post("/edges/batch", response_model=BatchOperationResponse, status_code=201)
658 | async def batch_create_edges(request: BatchCreateEdgesRequest, pool=Depends(get_pool)):
    |                                                                     ^^^^^^^^^^^^^^^^^
659 |     """
660 |     Create multiple edges in batch.
    |

W292 [*] No newline at end of file
   --> apps/memory_api/routes/graph_enhanced.py:729:6
    |
727 |             "batch_operations",
728 |         ],
729 |     }
    |      ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/hybrid_search.py:47:60
   |
46 | @router.post("/hybrid", response_model=HybridSearchResponse)
47 | async def hybrid_search(request: HybridSearchRequest, pool=Depends(get_pool)):
   |                                                            ^^^^^^^^^^^^^^^^^
48 |     """
49 |     Execute hybrid multi-strategy search.
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/hybrid_search.py:105:75
    |
104 | @router.post("/analyze", response_model=QueryAnalysisResponse)
105 | async def analyze_query(req: Request, request: QueryAnalysisRequest, pool=Depends(get_pool)):
    |                                                                           ^^^^^^^^^^^^^^^^^
106 |     """
107 |     Analyze query intent and recommend search strategies.
    |

F821 Undefined name `confidence`
   --> apps/memory_api/routes/hybrid_search.py:268:27
    |
266 |             "query": request.query,
267 |             "intent": analysis.intent.value,
268 |             "confidence": confidence,
    |                           ^^^^^^^^^^
269 |             "weights": {k.value: v for k, v in weights.items()},
270 |             "recommended_strategies": [
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/hybrid_search.py:288:40
    |
286 | @router.post("/compare")
287 | async def compare_search_strategies(
288 |     request: HybridSearchRequest, pool=Depends(get_pool)
    |                                        ^^^^^^^^^^^^^^^^^
289 | ):
290 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/hybrid_search.py:398:10
    |
396 |     project_id: str,
397 |     k: int = 10,
398 |     pool=Depends(get_pool),
    |          ^^^^^^^^^^^^^^^^^
399 | ):
400 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/routes/hybrid_search.py:519:6
    |
517 |             "gpt-4o",
518 |         ],
519 |     }
    |      ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/reflections.py:55:46
   |
53 | @router.post("/generate", response_model=GenerateReflectionResponse)
54 | async def generate_reflections(
55 |     request: GenerateReflectionRequest, pool=Depends(get_pool)
   |                                              ^^^^^^^^^^^^^^^^^
56 | ):
57 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:115:68
    |
114 | @router.post("/query", response_model=QueryReflectionsResponse)
115 | async def query_reflections(request: QueryReflectionsRequest, pool=Depends(get_pool)):
    |                                                                    ^^^^^^^^^^^^^^^^^
116 |     """
117 |     Query reflections with filters and optional semantic search.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:210:61
    |
208 | @router.get("/{reflection_id}", response_model=ReflectionUnit)
209 | async def get_reflection(
210 |     reflection_id: UUID, tenant_id: str, project: str, pool=Depends(get_pool)
    |                                                             ^^^^^^^^^^^^^^^^^
211 | ):
212 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:257:56
    |
255 | @router.get("/{reflection_id}/children", response_model=List[ReflectionUnit])
256 | async def get_child_reflections(
257 |     reflection_id: UUID, recursive: bool = False, pool=Depends(get_pool)
    |                                                        ^^^^^^^^^^^^^^^^^
258 | ):
259 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:292:46
    |
290 | @router.post("/graph", response_model=GetReflectionGraphResponse)
291 | async def get_reflection_graph(
292 |     request: GetReflectionGraphRequest, pool=Depends(get_pool)
    |                                              ^^^^^^^^^^^^^^^^^
293 | ):
294 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:362:56
    |
360 | @router.post("/relationships", response_model=CreateReflectionRelationshipResponse)
361 | async def create_reflection_relationship(
362 |     request: CreateReflectionRelationshipRequest, pool=Depends(get_pool)
    |                                                        ^^^^^^^^^^^^^^^^^
363 | ):
364 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:432:40
    |
430 | @router.get("/statistics/{tenant_id}/{project}", response_model=ReflectionStatistics)
431 | async def get_reflection_statistics(
432 |     tenant_id: str, project: str, pool=Depends(get_pool)
    |                                        ^^^^^^^^^^^^^^^^^
433 | ):
434 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> apps/memory_api/routes/reflections.py:463:68
    |
461 | @router.delete("/batch")
462 | async def delete_reflections_batch(
463 |     tenant_id: str, project: str, reflection_ids: List[UUID], pool=Depends(get_pool)
    |                                                                    ^^^^^^^^^^^^^^^^^
464 | ):
465 |     """
    |

W292 [*] No newline at end of file
   --> apps/memory_api/routes/reflections.py:510:95
    |
508 |     except Exception as e:
509 |         logger.error("delete_batch_failed", error=str(e))
510 |         raise HTTPException(status_code=500, detail=f"Batch deletion failed: {str(e)}") from e
    |                                                                                               ^
    |
help: Add trailing newline

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/token_savings.py:24:36
   |
22 |     project_id: Optional[str] = None,
23 |     period: str = Query("30d", description="Period for summary: 24h, 7d, 30d"),
24 |     service: TokenSavingsService = Depends(get_savings_service),
   |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 | ):
26 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/routes/token_savings.py:49:36
   |
47 |     request: Request,
48 |     interval: str = Query("day", description="Bucket interval: hour, day"),
49 |     service: TokenSavingsService = Depends(get_savings_service),
   |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
50 | ):
51 |     """
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> apps/memory_api/security.py:73:13
   |
71 |               unverified_header = jwt.get_unverified_header(token)
72 |           except JWTError:
73 | /             raise HTTPException(
74 | |                 status_code=status.HTTP_401_UNAUTHORIZED, detail="Invalid token header"
75 | |             )
   | |_____________^
76 |
77 |           rsa_key = {}
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security.py:114:13
    |
113 |           except jwt.ExpiredSignatureError:
114 | /             raise HTTPException(
115 | |                 status_code=status.HTTP_401_UNAUTHORIZED, detail="Token has expired"
116 | |             )
    | |_____________^
117 |           except jwt.JWTClaimsError:
118 |               raise HTTPException(
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security.py:118:13
    |
116 |               )
117 |           except jwt.JWTClaimsError:
118 | /             raise HTTPException(
119 | |                 status_code=status.HTTP_401_UNAUTHORIZED,
120 | |                 detail="Incorrect claims, please check audience and issuer",
121 | |             )
    | |_____________^
122 |           except Exception:
123 |               raise HTTPException(
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security.py:123:13
    |
121 |               )
122 |           except Exception:
123 | /             raise HTTPException(
124 | |                 status_code=status.HTTP_401_UNAUTHORIZED,
125 | |                 detail="Unable to parse authentication token",
126 | |             )
    | |_____________^
    |

B008 Do not perform function call `Security` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> apps/memory_api/security/auth.py:60:59
   |
59 | async def verify_token(
60 |     credentials: Optional[HTTPAuthorizationCredentials] = Security(security),
   |                                                           ^^^^^^^^^^^^^^^^^^
61 |     api_key: Optional[str] = Security(api_key_header),
62 | ) -> dict:
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security/auth.py:119:13
    |
117 |           except JWTError as e:
118 |               logger.warning("invalid_jwt_token", error=str(e))
119 | /             raise HTTPException(
120 | |                 status_code=status.HTTP_401_UNAUTHORIZED,
121 | |                 detail=f"Invalid authentication credentials: {str(e)}",
122 | |                 headers={"WWW-Authenticate": "Bearer"},
123 | |             )
    | |_____________^
124 |           except Exception as e:
125 |               logger.error("jwt_verification_error", error=str(e))
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security/auth.py:126:13
    |
124 |           except Exception as e:
125 |               logger.error("jwt_verification_error", error=str(e))
126 | /             raise HTTPException(
127 | |                 status_code=status.HTTP_401_UNAUTHORIZED,
128 | |                 detail="Authentication failed",
129 | |                 headers={"WWW-Authenticate": "Bearer"},
130 | |             )
    | |_____________^
131 |
132 |       # If both API key and token authentication are disabled, allow access
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security/auth.py:256:9
    |
254 |       except (ValueError, AttributeError):
255 |           logger.warning("check_tenant_access_invalid_tenant_id", tenant_id=tenant_id)
256 | /         raise HTTPException(
257 | |             status_code=status.HTTP_400_BAD_REQUEST,
258 | |             detail=f"Invalid tenant ID format: {tenant_id}",
259 | |         )
    | |_________^
260 |
261 |       # Check RBAC
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security/auth.py:376:9
    |
374 |           tenant_uuid = UUID(tenant_id)
375 |       except (ValueError, AttributeError):
376 | /         raise HTTPException(
377 | |             status_code=status.HTTP_400_BAD_REQUEST,
378 | |             detail=f"Invalid tenant ID format: {tenant_id}",
379 | |         )
    | |_________^
380 |
381 |       # Check permission
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/security/dependencies.py:185:13
    |
183 |               tenant_uuid = UUID(tenant_id)
184 |           except (ValueError, AttributeError):
185 | /             raise HTTPException(
186 | |                 status_code=status.HTTP_400_BAD_REQUEST,
187 | |                 detail=f"Invalid tenant ID format: {tenant_id}",
188 | |             )
    | |_____________^
189 |
190 |           # Check role
    |

B905 `zip()` without an explicit `strict=` parameter
   --> apps/memory_api/services/context_builder.py:375:17
    |
373 |             # Basic ranking by similarity
374 |             ranked_basic = sorted(
375 |                 zip(all_memories, similarity_scores),
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
376 |                 key=lambda x: x[1],
377 |                 reverse=True,
    |
help: Add explicit value for parameter `strict=`

B007 Loop control variable `query_id` not used within loop body
   --> apps/memory_api/services/evaluation_service.py:154:13
    |
153 |         # Calculate summary statistics
154 |         for query_id, results in search_results.items():
    |             ^^^^^^^^
155 |             total_documents += len(results)
156 |             for result in results:
    |
help: Rename unused `query_id` to `_query_id`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/services/graph_extraction.py:410:13
    |
408 |                 "graph_extraction_failed", project_id=project_id, error=str(e)
409 |             )
410 |             raise RuntimeError(f"Graph extraction failed: {e}")
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
411 |
412 |     async def _filter_factual_memories(
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/services/hybrid_search.py:346:13
    |
344 |                 error=str(e),
345 |             )
346 |             raise RuntimeError(f"Hybrid search failed: {e}")
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
347 |
348 |     async def _vector_search(
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/services/llm/orchestrator_adapter.py:100:13
    |
 98 |                   response_text=response.text,
 99 |               )
100 | /             raise ValueError(
101 | |                 f"Failed to parse LLM response as {response_model.__name__}: {e}"
102 | |             )
    | |_____________^
103 |
104 |       def _create_request(self, system: str, prompt: str, model: str) -> LLMRequest:
    |

B905 `zip()` without an explicit `strict=` parameter
   --> apps/memory_api/services/memory_scoring_v3.py:122:46
    |
120 |     )
121 |
122 |     for i, (memory, similarity) in enumerate(zip(memories, similarity_scores)):
    |                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
123 |         # Extract standard fields
124 |         access_count = memory.get("usage_count") or memory.get("access_count") or 0
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> apps/memory_api/services/reflection_pipeline.py:401:34
    |
399 |             # Group memories by cluster
400 |             clusters: Dict[str, List[Dict[str, Any]]] = {}
401 |             for memory, label in zip(valid_memories, cluster_labels):
    |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
402 |                 if label == -1:  # Skip noise in HDBSCAN
403 |                     continue
    |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
  --> apps/memory_api/services/vector_store/pgvector_store.py:29:38
   |
28 |         async with self.pool.acquire() as conn:
29 |             for memory, embedding in zip(memories, embeddings):
   |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^
30 |                 # pgvector expects a numpy array
31 |                 embedding_np = np.array(embedding)
   |
help: Add explicit value for parameter `strict=`

B905 `zip()` without an explicit `strict=` parameter
   --> apps/memory_api/services/vector_store/qdrant_store.py:177:41
    |
175 |         try:
176 |             points_to_upsert = []
177 |             for memory, dense_vector in zip(memories, embeddings):
    |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
178 |                 sparse_vector = self._get_sparse_vector(memory.content)
179 |                 points_to_upsert.append(
    |
help: Add explicit value for parameter `strict=`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/tasks/background_tasks.py:205:17
    |
203 |                     error=str(e),
204 |                 )
205 |                 raise self.retry(exc=e, countdown=300 * (2**self.request.retries))
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
206 |
207 |     return asyncio.run(main())
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/tasks/background_tasks.py:285:17
    |
283 |                     error=str(e),
284 |                 )
285 |                 raise self.retry(exc=e, countdown=60 * (2**self.request.retries))
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
286 |
287 |     return asyncio.run(main())
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/tasks/background_tasks.py:368:17
    |
366 |                 )
367 |                 # Retry with exponential backoff
368 |                 raise self.retry(exc=e, countdown=60 * (2**self.request.retries))
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
369 |
370 |     return asyncio.run(main())
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/tasks/background_tasks.py:595:17
    |
593 |                 logger.error("decay_task_fatal_error", error=str(e))
594 |                 # Retry with exponential backoff
595 |                 raise self.retry(exc=e, countdown=300 * (2**self.request.retries))
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
596 |
597 |     return asyncio.run(main())
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/memory_api/tasks/background_tasks.py:640:17
    |
638 |             except Exception as e:
639 |                 logger.error("maintenance_cycle_failed", error=str(e))
640 |                 raise self.retry(exc=e, countdown=300 * (2**self.request.retries))
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
641 |
642 |     return asyncio.run(main())
    |

B007 Loop control variable `i` not used within loop body
   --> apps/memory_api/tests/test_api_client.py:100:9
    |
 99 |     # Trigger failures up to threshold
100 |     for i in range(circuit_breaker.failure_threshold):
    |         ^
101 |         with pytest.raises(Exception):
102 |             await circuit_breaker.call(failing_func)
    |
help: Rename unused `i` to `_i`

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_api_client.py:101:14
    |
 99 |     # Trigger failures up to threshold
100 |     for i in range(circuit_breaker.failure_threshold):
101 |         with pytest.raises(Exception):
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
102 |             await circuit_breaker.call(failing_func)
    |

B007 Loop control variable `i` not used within loop body
   --> apps/memory_api/tests/test_api_client.py:264:9
    |
263 |     backoff = initial_backoff
264 |     for i in range(5):
    |         ^
265 |         assert backoff <= max_backoff
266 |         backoff = min(int(backoff * multiplier), max_backoff)
    |
help: Rename unused `i` to `_i`

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_background_tasks.py:137:14
    |
136 |         # Execute should raise exception (retry)
137 |         with pytest.raises(Exception):
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
138 |             # Bind self to the task
139 |             task = extract_graph_lazy
    |

B017 Do not assert blind exception: `Exception`
  --> apps/memory_api/tests/test_circuit_breaker.py:72:18
   |
70 |         # Trigger 3 failures to reach threshold
71 |         for _ in range(3):
72 |             with pytest.raises(Exception):
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^
73 |                 await cb.call(failing_func)
   |

B017 Do not assert blind exception: `Exception`
  --> apps/memory_api/tests/test_circuit_breaker.py:89:18
   |
87 |         # Open the circuit
88 |         for _ in range(2):
89 |             with pytest.raises(Exception):
   |                  ^^^^^^^^^^^^^^^^^^^^^^^^
90 |                 await cb.call(failing_func)
   |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:116:18
    |
114 |         # Open the circuit
115 |         for _ in range(2):
116 |             with pytest.raises(Exception):
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
117 |                 await cb.call(failing_func)
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:150:18
    |
148 |         # Open the circuit
149 |         for _ in range(2):
150 |             with pytest.raises(Exception):
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
151 |                 await cb.call(failing_func)
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:183:18
    |
181 |         # Open the circuit
182 |         for _ in range(2):
183 |             with pytest.raises(Exception):
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
184 |                 await cb.call(failing_func)
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:196:14
    |
195 |         # Failure should immediately reopen
196 |         with pytest.raises(Exception):
    |              ^^^^^^^^^^^^^^^^^^^^^^^^
197 |             await cb.call(failing_func)
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:230:18
    |
228 |         # Open the circuit
229 |         for _ in range(2):
230 |             with pytest.raises(Exception):
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
231 |                 await cb.call(failing_func)
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:288:18
    |
286 |         # 3 failures
287 |         for _ in range(3):
288 |             with pytest.raises(Exception):
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
289 |                 await cb.call(failing_func)
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_circuit_breaker.py:441:18
    |
439 |         # Phase 2: CLOSED state - failures accumulate
440 |         for i in range(3):
441 |             with pytest.raises(Exception):
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^
442 |                 await cb.call(unstable_func, should_fail=True)
443 |             if i < 2:
    |

B017 Do not assert blind exception: `Exception`
   --> apps/memory_api/tests/test_graph_algorithms.py:423:10
    |
421 |     mock_conn.fetch.side_effect = Exception("DB Error")
422 |
423 |     with pytest.raises(Exception):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^
424 |         await service.load_tenant_graph(uuid4())
    |

I001 [*] Import block is un-sorted or un-formatted
  --> apps/memory_api/tests/test_hybrid_search.py:7:1
   |
 5 |   """
 6 |
 7 | / from unittest.mock import AsyncMock, Mock, patch
 8 | | from uuid import uuid4, UUID
 9 | |
10 | | import pytest
   | |_____________^
11 |
12 |   # Skip tests if sentence_transformers is not installed (ML dependency)
   |
help: Organize imports

B007 Loop control variable `i` not used within loop body
   --> apps/memory_api/tests/test_hybrid_search.py:767:17
    |
766 |             # Create edges: A -> B -> C -> D -> E
767 |             for i, (source, target) in enumerate(
    |                 ^
768 |                 [("A", "B"), ("B", "C"), ("C", "D"), ("D", "E")]
769 |             ):
    |
help: Rename unused `i` to `_i`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/ml_service/main.py:169:9
    |
167 |       except Exception as e:
168 |           logger.exception("embedding_generation_failed", error=str(e))
169 | /         raise HTTPException(
170 | |             status_code=500, detail=f"Embedding generation failed: {str(e)}"
171 | |         )
    | |_________^
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/ml_service/main.py:208:9
    |
206 |       except Exception as e:
207 |           logger.exception("entity_resolution_failed", error=str(e))
208 | /         raise HTTPException(
209 | |             status_code=500, detail=f"Entity resolution failed: {str(e)}"
210 | |         )
    | |_________^
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/ml_service/main.py:255:9
    |
253 |       except Exception as e:
254 |           logger.exception("keyword_extraction_failed", error=str(e))
255 | /         raise HTTPException(
256 | |             status_code=500, detail=f"Keyword extraction failed: {str(e)}"
257 | |         )
    | |_________^
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> apps/ml_service/main.py:323:9
    |
321 |       except Exception as e:
322 |           logger.exception("triple_extraction_failed", error=str(e))
323 | /         raise HTTPException(
324 | |             status_code=500, detail=f"Triple extraction failed: {str(e)}"
325 | |         )
    | |_________^
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> apps/ml_service/services/nlp_service.py:80:17
   |
78 |               except ImportError as e:
79 |                   logger.error("spacy_not_installed", error=str(e))
80 | /                 raise RuntimeError(
81 | |                     "spaCy is not installed. Please install it: pip install spacy"
82 | |                 )
   | |_________________^
83 |
84 |       def extract_keywords(
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> apps/ml_service/services/triple_extraction.py:78:17
   |
76 |             except ImportError as e:
77 |                 logger.error("spacy_not_installed", error=str(e))
78 |                 raise RuntimeError("spaCy not installed")
   |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |
80 |     def extract_triples(self, text: str, language: str = "en") -> List[Dict[str, Any]]:
   |

B905 `zip()` without an explicit `strict=` parameter
  --> apps/reranker_service/main.py:51:24
   |
50 |     # Assign the new scores to the items
51 |     for item, score in zip(req.items, scores):
   |                        ^^^^^^^^^^^^^^^^^^^^^^
52 |         item.score = float(score)
   |
help: Add explicit value for parameter `strict=`

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> integrations/ollama-wrapper/main.py:56:9
   |
54 |         )
55 |         console.print(e.response.text)
56 |         raise typer.Exit(1)
   |         ^^^^^^^^^^^^^^^^^^^
57 |     except Exception as e:
58 |         console.print(
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> integrations/ollama-wrapper/main.py:61:9
   |
59 |             f"[bold red]An unexpected error occurred while querying RAE: {e}[/bold red]"
60 |         )
61 |         raise typer.Exit(1)
   |         ^^^^^^^^^^^^^^^^^^^
62 |
63 |     # 2. Construct the final prompt
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> integrations/ollama-wrapper/main.py:107:9
    |
105 |         )
106 |         console.print(e.response.text)
107 |         raise typer.Exit(1)
    |         ^^^^^^^^^^^^^^^^^^^
108 |     except Exception as e:
109 |         console.print(
    |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
   --> integrations/ollama-wrapper/main.py:112:9
    |
110 |             f"[bold red]An unexpected error occurred while calling Ollama: {e}[/bold red]"
111 |         )
112 |         raise typer.Exit(1)
    |         ^^^^^^^^^^^^^^^^^^^
113 |
114 |     # 4. (Optional) Trigger reflection hook in RAE
    |

Found 171 errors.
[*] 14 fixable with the `--fix` option (16 hidden fixes can be enabled with the `--unsafe-fixes` option).
make: *** [Makefile:124: lint] Error 1
